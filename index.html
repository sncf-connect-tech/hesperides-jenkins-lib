<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.4.0">
    <meta charset="utf-8">
    <title>Documentation of hesperides-jenkins-lib</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism.min.css" rel="stylesheet">
    <style>
    html { background-color:#fefefe; }
    body {
    font-family: Open Sans,Arial;
    color: #454545;
    font-size: 16px;
    margin: 2em auto;
    max-width: 80rem;
    padding: 1em;
    line-height: 1.4;
    text-align: justify;
    }
    h2 { margin-top: 3rem; }
    body > section > h2 { font-size: 2.5rem; }
    </style>
</head>
<body>
    <section>
        <h2>Applications & platforms</h2>
        <section>
            <h2>hesperides.getAppInfo</h2>Example:
            <pre><code>
        import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getAppInfo(app: 'HJL')))
        </code></pre>
        </section>
        <section>
            <h2>hesperides.getPlatformInfo</h2>Example:
            <pre><code>
        import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getPlatformInfo(app: 'HJL', platform: 'USN1')))
        </code></pre>
        </section>
        <section>
            <h2>hesperides.createPlatform</h2>Create a new application platform, with a 1st version, and optionally some modules<br>
            Example:
            <pre><code>
        hesperides.createPlatform app:'ABC' platform:'USN1' version:'1.0', isProduction:true,
                                  fromApplication:'DEF', fromPlatform:'PRD2', copyPropertiesForUpgradedModules:false
        hesperides.createPlatform app:'ABC' platform:'USN1' version:'0.0', modules: [
            [
              id: 0,
              name: 'toto',
              version: '0.0',
              path: '#GROUP',
              instances: [
                [
                  name: 'TATA',
                  key_values: [
                    [
                      value: 'prop',
                      name: 42
                    ]
                  ]
                ]
              ],
              propertiesPath: '#GROUP#toto#0.0#WORKINGCOPY',
              working_copy: true
            }
          ]
        </code></pre>
        </section>
        <section>
            <h2>hesperides.deletePlatform</h2>Example:
            <pre><code>
        hesperides.deletePlatform(app: 'HJL', platform: 'USN1')
        </code></pre>
        </section>
        <section>
            <h2>hesperides.setPlatformVersion</h2>Change a plateform version.<br>
            Example:
            <pre><code>
        hesperides.setPlatformVersion app:'HJL', platform:'USN2', checkCurrentVersion:'1-18-SNAPSHOT',
                                      newVersion:'1.24-SNAPSHOT', copyPropertiesForUpgradedModules:false
        </code></pre>
        </section>
        <section>
            <h2>hesperides.cleanUnusedProperties</h2>Clean all unused properties on a platform. You can specify a component path (optional)<br>
            Example:
            <pre><code>
        hesperides.cleanUnusedProperties app:'HJL', platform:'USN2', propertiesPath:'#HJLMODULE#JAR#hjlcomponent#1.0.0.0#RELEASE'
        </code></pre>
        </section>
    </section>
    <section>
        <h2>Modules & deployed modules</h2>
        <section>
            <h2>hesperides.getModule</h2>Example:
            <pre><code>
        import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getModule(moduleName: 'toto', version: '1.0')))
        </code></pre>
        </section>
        <section>
            <h2>hesperides.doesModuleExist</h2>Example:
            <pre><code>
        echo hesperides.doesModuleExist(moduleName: 'toto', version: '1.0', moduleType: 'workingcopy')
        </code></pre>
        </section>
        <section>
            <h2>hesperides.createModule</h2>Example:
            <pre><code>
        hesperides.createModule(moduleName: 'toto', version: '1.0')
        </code></pre>
        </section>
        <section>
            <h2>hesperides.getModuleVersions</h2>Retrieve the versions of a module.<br>
            Example:
            <pre><code>
        import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getModuleVersions(moduleName: 'toto')))
        </code></pre>
        </section>
        <section>
            <h2>hesperides.releaseModule</h2>Release one or several modules from their working copies.<br>
            Example:
            <pre><code>
        hesperides.releaseModule moduleName: 'toto', workingcopyVersion: '1.0-SNAPSHOT' releaseVersion: '1.0'
        </code></pre>
        </section>
        <section>
            <h2>hesperides.deleteModule</h2>Example:
            <pre><code>
        hesperides.deleteModule version: 'toto', version: '1.0', moduleType: 'workingcopy'
        </code></pre>
        </section>
        <section>
            <h2>hesperides.putModuleOnPlatform</h2>Example:
            <pre><code>
        hesperides.putModuleOnPlatform moduleName: 'toto', moduleVersion: '1.0', isWorkingCopy: true
                                       app: 'HJL', platform:'USN2', logicGroupPath: '#HJL#WAS'
        </code></pre>
        </section>
        <section>
            <h2>hesperides.setPlatformModuleVersion</h2>Change the version of one module on a plateform.<br>
            Example:
            <pre><code>
        hesperides.setPlatformModuleVersion app:'HJL', platform:'USN2', moduleName:'hjl-engine-api', checkCurrentVersion:'1-18-SNAPSHOT',
                                            newVersion:'1.24-SNAPSHOT', isWorkingCopy: true, path: '#LOGIC#PATH',
                                            copyPropertiesForUpgradedModules: false
        </code></pre>
        </section>
        <section>
            <h2>hesperides.setPlatformModulesVersion</h2>Change the version of all modules on a plateform. Same parameters as <code>setPlatformModuleVersion</code> without the need for <code>moduleName</code>.<br>
            Example:
            <pre><code>
        hesperides.setPlatformModulesVersion app:'HJL', platform:'USN2', newVersion:'1.24-SNAPSHOT'
        </code></pre>
        </section>
    </section>
    <section>
        <h2>Templates</h2>
        <section>
            <h2>hesperides.createTemplate</h2>Create a new template on a given workingcopy module for a specific version.<br>
            Example:
            <pre><code>
        hesperides.createTemplate moduleName: 'toto', moduleVersion: '0.1.0',
                                  location: '/appl/{{username}}/properties/application.yml', filename: 'application.yml', content: 'keycloakUrl: {{keycloak.url}}',
                                  title: 'BaseSpringBootConfig', filePerms: [user: [read: true, write: true], group: [read: true], other: [read: true]]
        </code></pre>
        </section>
        <section>
            <h2>hesperides.deleteTemplate</h2>Example:
            <pre><code>
        hesperides.deleteTemplate moduleName: 'toto', moduleVersion: '0.1.0', templateName: 'app.conf'
        </code></pre>
        </section>
        <section>
            <h2>hesperides.upsertTemplate</h2>Upsert (create or update) a template on a given workingcopy module. Existing template for a module version is replaced.<br>
            Example:
            <pre><code>
        hesperides.upsertTemplate moduleName: 'corporate-client-aggregator', moduleVersion: '1.1.10',
                                  location: '/appl/{{username}}/properties/application.yml', filename: 'application.yml', content: '{keycloakUrl: {{keycloak.url}}}',
                                  title: 'BaseSpringBootConfig', filePerms: [user: [read: true, write: true], group: [read: true], other: [read: true]]
        </code></pre>
        </section>
        <section>
            <h2>hesperides.updateTemplate</h2>Update a template on a given module for a specific version.<br>
            Example:
            <pre><code>
        hesperides.updateTemplate moduleName: 'toto', moduleVersion: '0.1.0',
                                  location: '/appl/{{username}}/properties/application.yml', filename: 'application.yml', content: 'keycloakUrl: {{keycloak.url}}',
                                  title: 'BaseSpringBootConfig', filePerms: [user: [read: true, write: true], group: [read: true], other: [read: true]]
        </code></pre>
        </section>
        <section>
            <h2>hesperides.upsertFromDescriptor</h2>Upsert (create or update) one or several workingcopy module(s) and their templates from a file descriptor. Any previously existing templates are deleted beforehand. If 'title' field isn't set, the 'filename' is used instead.<br>
            Example jenkinsfile code :
            <pre><code>
        hesperides.upsertFromDescriptor descriptorPath: './hesperides-descriptor.json', moduleVersion: '1.1.10'
        </code></pre>Examble descriptor file :
            <pre><code class="language-json">
        {
          "hjl-engine-api": {
            "engine-api/src/main/resources-dev/template-application-prod.yml": {
              "title": "application-prod.yml",
              "filename": "application-prod.yml",
              "location": "/appl/{{userwas}}/properties"
            },
            "engine-api/src/main/resources-dev/template-logback.properties": {
              "title": "logback.properties",
              "filename": "logback.properties",
              "location": "/appl/{{userwas}}/properties"
              }
          },
          "HJL-engine-core": {
            "engine-core/src/main/resources-dev/template-application-core-prod.yml": {
              "title": "application-core-prod.yml",
              "filename": "application-core-prod.yml",
              "location": "/appl/{{userwas}}/properties",
              "filePerms": {"user": {"read": true, "write": true}, "group": {"read": true}, "other": {"read": true}}
            }
          }
        }
        </code></pre>
        </section>
        <section>
            <h2>hesperides.getTemplates</h2>Example:
            <pre><code>
        import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getTemplates(moduleName: 'toto', version: '1.0', moduleType: 'workingcopy')))
        </code></pre>
        </section>
        <section>
            <h2>hesperides.getTemplate</h2>Example:
            <pre><code>
        import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getTemplate(moduleName: 'toto', version: '1.0', moduleType: 'workingcopy', filename: 'app.conf')))
        </code></pre>
        </section>
        <section>
            <h2>hesperides.getModulePropertiesForPlatform</h2>Example:
            <pre><code>
        import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getModuleTemplateProperties(moduleName: 'toto', version: '1.0', moduleType: 'workingcopy')))
        </code></pre>
        </section>
    </section>
    <section>
        <h2>Properties</h2>
        <section>
            <h2>hesperides.getModulePropertiesForPlatform</h2>Example:
            <pre><code>
        import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getModulePropertiesForPlatform(app: 'HJL', platform: 'USN1', modulePropertiesPath: '#HJL#WAS#toto#1.0#WORKINGCOPY')))
        </code></pre>
        </section>
        <section>
            <h2>hesperides.updateProperties</h2>Change instance/module/global properties on a given Hesperides platform, from a JSON file listing deltas. Existing properties are not altered. The properties can also be defined by their path.<br>
            Example JSON deltas file:
            <pre><code class="language-json">
        {
          "hjl-engine-api": {
            "api_log_level": "DEBUG",
            "engine.config.products_types": "HOTEL,ARTICLE,IDAVIS,VOITURE,IDCAB,OUICAR",
            "iterable_properties": {
              "clients.configuration": [
                {
                  "clientId": "new_home-MonVoyage",
                  "authorizedProducts": "\"ARTICLE\", \"IDCAB\""
                }
              ]
            }
          },
          "another-module#INSTANCE_NAME": {},
          "another-third-module": {
            "polymorphistic_property": "a default value on the platform"
          },
          "path:#anotherLogicGroup#another-third-module": {
            "polymorphistic_property": "an overriden value for a specific path"
          },
          "GLOBAL": {}
        }
        </code></pre><br>
            Example:
            <pre><code>
        hesperides.updateProperties app: 'HJL', platform: 'USN1', jsonPropertyUpdates: "$env.WORKSPACE/hesperides_changes/HJL-USN1.json", commitMsg: 'Test'
        </code></pre>
        </section>
        <section>
            <h2>hesperides.updatePropertiesForPlatform</h2>Update properties for given module path. Usually, before using this method, retrieve properties to update with getModulePropertiesForPlatform(...) and properties_path from chosen module<br>
            Example:
            <pre><code>
       hesperides.updatePropertiesForPlatform(app: 'APP', platform: 'PTF',
                                              modulePropertiesPath: '#APP#PTF#module#1.0#WORKINGCOPY', commitMsg: 'MyCommitMsg',
                                              properties: myJsonPropertiesRetreivedFromGetAPI, platformVid: platformVid, auth: auth)
       </code></pre>
        </section>
        <section>
            <h2>hesperides.getDiffProperties</h2>Allow the comparison of properties between one platform or module with itself (minus 2 hours) or between 2 platforms or 2 modules. This uses the REST API /properties/diff<br>
            <b>NB :</b> For the "timestampDate" parameter (which is optional), you have to generate a Date object as parameter.<br>
            Example:
            <pre><code>
           hesperides.getDiffProperties(
               app: 'APP', 
               platform: 'PTF', 
               modulePropertiesPath: '#APP#PTF#module#1.0#WORKINGCOPY', 
               toApplication: APP2, 
               toPlatform: PTF2, 
               toModulePropertiesPath: '#APP#PTF2#module#1.0#WORKINGCOPY')
       </code></pre>
        </section>
        <section>
            <h2>hesperides.getDiffPropertiesAsString</h2>Build a text representation of the output of <a href="#hesperides.getDiffProperties"><code>getDiffProperties</code></a> as a 2 columns table showing the differences of properties values between 2 platforms or deployed modules.<br>
            Example:
            <pre><code>
           // Diff. between 2 versions of a same module at a different timestamp
           hesperides.getDiffPropertiesAsString(
               app: 'APP',
               platform: 'PTF', 
               modulePropertiesPath: '#APP#PTF#module#1.0#WORKINGCOPY',
               diffType: 'differing')
         OR
           // Diff. between 2 versions of a same module on 2 differents platforms
           hesperides.getDiffPropertiesAsString(
               app: 'APP',
               platform: 'PTF',
               modulePropertiesPath: '#APP#PTF#module#1.0#WORKINGCOPY',
               toApplication: APP2,
               toPlatform: PTF2,
               toModulePropertiesPath: '#APP#PTF2#module#1.0#WORKINGCOPY',
               diffType: 'differing')
       </code></pre>
        </section>
    </section>
    <section>
        <h2>Instances</h2>
        <section>
            <h2>hesperides.getInstanceProperties</h2>Example:
            <pre><code>
       import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getInstanceProperties(app: 'APP', platform: 'PTF', moduleName: 'toto', instance: 'APPPTFI1')))
       </code></pre>
        </section>
        <section>
            <h2>hesperides.createInstance</h2>Example:
            <pre><code>
       hesperides.createInstance(app: 'APP', platform: 'PTF', moduleName: 'toto', instance: 'APPPTFI1')
       </code></pre>
        </section>
        <section>
            <h2>hesperides.deleteInstance</h2>Example:
            <pre><code>
       hesperides.deleteInstance(app: 'APP', platform: 'PTF', moduleName: 'toto', instance: 'APPPTFI1')
       </code></pre>
        </section>
        <section>
            <h2>hesperides.getInstanceFiles</h2>Example:
            <pre><code>
       import static groovy.json.JsonOutput.*
        echo prettyPrint(toJson(hesperides.getInstanceFiles(app: 'APP', platform: 'PTF', moduleName: 'toto', instance: 'APPPTFI1')))
       </code></pre>
        </section>
    </section>
    <script>
    // Adding a class on all <code> elements for PrismJS to highlight code
    [].forEach.call(document.getElementsByTagName('code'), code => {
        code.classList.add(code.textContent.trim().charAt(0) === '{' ? 'language-json' : 'language-groovy')
    })
    // Auto-generating a summary:
    const ul = document.createElement('ul')
    document.querySelectorAll('body > section').forEach(section => {
        const h2 = section.getElementsByTagName('h2')[0]
        const li = document.createElement('li')
        const a = document.createElement('a')
        h2.id = h2.textContent
        a.textContent = h2.textContent
        a.href = '#' + h2.id
        li.append(a)
        let subUl = null
        section.querySelectorAll('section > section > h2').forEach(subH2 => {
            if (!subUl) {
                subUl = document.createElement('ul')
                li.append(subUl)
            }
            const subLi = document.createElement('li')
            const subA = document.createElement('a')
            subH2.id = subH2.textContent
            subA.textContent = subH2.textContent
            subA.href = '#' + subH2.id
            subLi.append(subA)
            subUl.append(subLi)
        })
        ul.append(li)
    })
    document.body.children[0].prepend(ul)
    </script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/prism.min.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
